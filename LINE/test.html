<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  
    <link rel="icon" href="data:image/png;base64,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" type="image/gif" sizes="16x16">
   
    <title>LINE API</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.4/qs.min.js" 
  integrity="sha512-BHtomM5XDcUy7tDNcrcX1Eh0RogdWiMdXl3wJcKB3PFekXb3l5aDzymaTher61u6vEZySnoC/SAj2Y/p918Y3w=="
   crossorigin="anonymous"></script>
    
    <style>
        .show{
            width:30%;
        }
    </style>
    <script src="index.js"></script>
</head>
<body class="jumbotron text-center ">
    <!-- <h1>LINE API</h1> -->

    <button type="button" id="generate" class="btn btn-primary m-4" onclick()="generate()">Generate data</button>

    <div id="output" ></div><br>
    <!-- add friend -->
    <a href="https://lin.ee/cLEBQLf"><img src="https://scdn.line-apps.com/n/line_add_friends/btn/en.png" alt="Add friend" height="36" border="0"></a>
    <br>

    <!-- Login button -->
    <a href='https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=1654645518&redirect_uri=https%3A%2F%2Ffatmab2809.github.io%2FDemo1%2F&state=12345abcde&scope=profile%20openid%20email'>
    <img src='btn_login_base.png' class="mt-3">
    </a><br>
    
<script>
    let Client_ID = '1654645518'
    let Client_secret = '654de9204e47f9442567599eaf721ff0'
    let code = '1Jyj6DluPDPvdbxs80oO'
    let redirect_uri = 'https%3A%2F%2Ffatmab2809.github.io%2FDemo1%2F'
    let grant_type = 'authorization_code'
    let access_token
    document.getElementById('generate').addEventListener('click',generate)


        async function generate(e){
           e.preventDefault()

           const data = {
               'grant_type' : 'refresh_token',
               'refresh_token' : '2PZUexgrC02XNp4OxMbS',
               'client_id' : Client_ID,
               'client_secret' : Client_secret,

           };

           var config = {
             'method': 'POST',
             'url': 'https://api.line.me/oauth2/v2.1/token',
             'headers': {
                'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
              },
             'data' : Qs.stringify(data)
           };

           
            // refresh access token    
            await axios(config)
            .then((resp) => {
                console.log(resp);
                console.log(resp.data.access_token)
                access_token = resp.data.access_token
            })
            .catch((err) => console.log(err))

            //fetch user profile data
            // console.log('User Profile');
            let promise = fetchdata(Client_ID,Client_secret,code,redirect_uri,grant_type,access_token)
        }
    
        async function fetchdata(Client_ID,Client_secret,code,redirect_uri,grant_type,access_token){
        
            await fetch('https://api.line.me/v2/profile',{
            method: 'GET',
            headers: {
                'Content-Type' : 'application/json',
                'Authorization': 'Bearer '+ access_token
            }
        })
        .then((res) => res.json())  //converts response to promise
        .then((data) => {
            console.log(data)
            var output = `<p>User Name- ${data.displayName} </p><br>
                            <p>User Id- ${data.userId}</p><br>`
            if(data.statusMessage){
                output +=`<p>Status Message- ${data.statusMessage}</p>`
            }
            document.getElementById('output').innerHTML = output;
            let imgurl = data.pictureUrl
            if(imgurl){
                let Img = document.createElement('img')
                Img.setAttribute('src',`${imgurl}`)
                Img.classList.add('show')
                document.querySelector('#output').appendChild(Img)
           
            }
            
            })
            
        .catch((err) => console.log(err))
    //    fetch friendship status
       await fetch('https://api.line.me/friendship/v1/status',{
               method: 'GET',
               headers:{
                'Authorization': 'Bearer '+ access_token
               }
           })
           .then((res) => res.json())
           .then((data) => {
               console.log('Friendship Status:');
               console.log(data.friendFlag);
               if(data.friendFlag)
                   document.getElementById('output').innerHTML += '<br>Friendship Status :  Added as Friend';
               else
                    document.getElementById('output').innerHTML += '<br>Friendship Status :  Not a Friend';
           })
       
   
    }  
        
    </script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>